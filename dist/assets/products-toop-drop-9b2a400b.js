import{j as t,aU as F,t as m,T as f,bu as A,b as j,aP as M,bv as B,bw as $,f as b,s as T,a8 as P,r as p,aT as L,ab as N,bo as x,aK as w}from"./index-335be6bc.js";import{S as R,u as Q}from"./use-query-filter-82542176.js";import{F as H,u as W}from"./filter-button-group-69656d3d.js";import{S as O,P as _}from"./Star-b7589792.js";import{o as S,c as U}from"./statics-f6863f48.js";import{u as Y}from"./use-categories-filter-4617dde9.js";import{C as G}from"./category-product-autocomplete-5f17f107.js";import{a as J,b as K,c as q}from"./DialogContent-2da759e4.js";import{D as V}from"./DialogTitle-cffb5590.js";import{T as C}from"./TextField-e3426f14.js";import{A as X}from"./Autocomplete-7da48e1d.js";import{k as Z,e as ee,q as te,a as re,b as se,o as ae}from"./bahrain-57f02bd3.js";import{q as k}from"./functions-6046b92c.js";import{u as z}from"./useDispatch-5616ae48.js";import"./ButtonGroup-59079b0e.js";import"./useControlled-35363894.js";import"./useSlot-06d6b379.js";import"./categories-55af903f.js";import"./Paper-7bffdec0.js";import"./FormControl-0c7a5a9b.js";import"./isMuiElement-28855bcf.js";import"./List-429b0059.js";import"./Grow-32d2c9c3.js";import"./Portal-29f66c29.js";import"./Close-a8700400.js";import"./Popper-6a651f11.js";import"./moment-fbc5633a.js";const oe=({queryFilter:e,setQueryFilter:s,setFilterOpen:a,handleClear:c})=>{const r=()=>{s(o=>{const n={...o};return o.isFavorite?delete n.isFavorite:n.isFavorite=!0,{...n}})};return t.jsx("div",{className:"datatableTitle",children:t.jsxs("div",{className:"searchBar",children:[t.jsx(R,{queryFilter:e,setQueryFilter:s}),t.jsx(F,{onClick:r,sx:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"#F1F1F1",height:"40px",width:"40px",borderRadius:"50%","&:hover":{backgroundColor:"#D3D3D3"}},children:t.jsx(O,{fontSize:"large",sx:{color:e.isFavorite?"var(--color-main)":"#B3B3B3"}})}),t.jsx(H,{queryFilter:e,setFilterOpen:a,handleClear:c,countColorFilter:1})]})})};const ie=({filterOpen:e=!1,setFilterOpen:s,queryFilter:a,setQueryFilter:c})=>{const{query:r,handleAutocompleteChange:o,handleInput:n,handleClear:u,handleFilter:l,setQuery:d}=W(a,c,s),{choosenCategories:i,categoriesList:g,handleCategoriesChange:v}=Y(r,d);return t.jsxs(J,{open:e,onClose:()=>s(!1),sx:{height:"100%"},maxWidth:"md",children:[t.jsx(V,{className:"dialog-title",children:t.jsx("span",{className:" capitalize",children:m("products filter")})}),t.jsx(K,{className:"products-filter-container",children:t.jsx("div",{className:"filter-section",children:t.jsx("div",{className:"filter-product infos-filter ",children:t.jsxs("div",{className:"left-filter",children:[t.jsxs("div",{className:"filter-operation",children:[t.jsx(C,{sx:{flex:1},id:"price",label:m("price"),value:(r==null?void 0:r.price)||"",type:"number",variant:"outlined",onChange:n}),t.jsx(X,{sx:{flex:1},id:"priceOperation",options:S,value:S.find(h=>h.value===(r==null?void 0:r.priceOperation))||null,onChange:(h,I)=>{o("priceOperation",I)},getOptionLabel:h=>h.label,renderInput:h=>t.jsx(C,{...h,label:m("operation"),variant:"outlined"})})]}),t.jsx(G,{choosenCategories:i,categoriesList:g,handleCategoriesChange:v,label:"category"})]})})})}),t.jsxs(q,{children:[t.jsx(f,{onClick:u,children:m("clear")}),t.jsx(f,{onClick:l,children:m("filter")})]})]})};const E=async(e,s)=>{s(A());try{const a=await j.get(`/product-affiliate/pagination?${e}&visibilityScope=${M.toopDrop}`);s(B(a.data))}catch(a){s($()),b(a,s)}},ce=async(e,s)=>{try{const a=await j.post("/product-affiliate/favorite",e);T(a.data.responseMessage,s)}catch(a){b(a,s)}},ne=async(e,s)=>{try{const a=await j.delete(`/product-affiliate/favorite/${e.productId}`,e);T(a.data.responseMessage,s)}catch(a){b(a,s)}},le={70:Z,71:ee,72:te,73:re,74:se,75:ae},de=({info:e})=>{var u,l,d;const[s]=P(),[a,c]=p.useState([]);p.useEffect(()=>{var g;const i=[...new Set((g=e==null?void 0:e.toopDropPrice)==null?void 0:g.flatMap(v=>v.country))];c(i)},[]);const r=(u=e==null?void 0:e.images)==null?void 0:u.filter(i=>!(i!=null&&i.startsWith("NOT_FOUND")))[0],o=z(),n=async()=>{const i={productId:e==null?void 0:e._id};e.isFavorite?await ne(i,o):await ce(i,o),await E(k(Object.fromEntries(s.entries())),o)};return t.jsx(L,{to:`/products-toop-drop/${e==null?void 0:e._id}`,style:{textDecoration:"none"},children:t.jsxs("div",{className:`product ${e.isValidated!==!0?"active":"in-active"}`,children:[t.jsx("div",{className:"img-container",style:{backgroundImage:r?`url('${r}')`:"none"}}),t.jsx("div",{className:"info-container",children:t.jsxs("div",{className:"container",children:[t.jsx("div",{className:"title",children:e==null?void 0:e.name}),t.jsx("div",{style:{backgroundColor:`rgba(var(--color-${m(e.currentStatus,{lng:"en"})}-rgb), 1)`},className:`status-tag cellWithStatus capitalize ${m(e==null?void 0:e.currentStatus,{lng:"en"})}`,children:m(e.currentStatus)}),t.jsx(F,{onClick:i=>{i.preventDefault(),n()},sx:{position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",top:"4%",right:"5%",backgroundColor:"#F2F2F2D2",padding:"3px",height:"30px",width:"30px",borderRadius:"50%","&:hover":{backgroundColor:"#D3D3D3"}},children:t.jsx(O,{sx:{color:e.isFavorite?"#FFCD29":"#B3B3B3"}})}),t.jsx("div",{className:"sub-info",children:t.jsxs("div",{children:[t.jsx("div",{className:" price ",children:t.jsxs("span",{className:"value uppercase dollar",children:[(l=e==null?void 0:e.toopDropPrice[0].price)==null?void 0:l.toFixed(2)," ",m(U[(d=e==null?void 0:e.offers)==null?void 0:d.country])]})}),t.jsx("div",{className:"countries",children:a.map(i=>t.jsx("img",{src:le[i],alt:"",className:"country"}))})]})})]})})]})})},ue=({numberOfTotalProducts:e,numberOfCardsToShow:s,paginationModel:a,setPaginationModel:c,products:r,queryFilter:o,setQueryFilter:n})=>(o==null?void 0:o.isFavorite)&&(!r||r.list.length===0)?t.jsxs("div",{className:"noFavoritesMessage",style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",marginTop:"2rem"},children:[t.jsx(N,{variant:"h3",sx:{fontSize:"24px",color:"var(--color-main)"},children:"You don't have favorite products"}),t.jsx(N,{variant:"body1",style:{margin:"1rem 0",color:"var(--color-gray)"},children:"You should add products to favorites."}),t.jsx(f,{className:"primary-button",onClick:()=>{n(l=>{const d={...l};return console.log(d),delete d.isFavorite,console.log(d),{...d}})},children:"Show All Products"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"container-products",children:r==null?void 0:r.list.map(l=>t.jsx(de,{info:l},l.id))}),t.jsx(_,{numberOfTotalProducts:e,numberOfCardsToShow:s,paginationModel:a,setPaginationModel:c})]}),D=(e,s,a)=>{let c;a===x.cards?c=[50].includes(Number(e))?Number(e):50:c=[10,25,50].includes(Number(e))?Number(e):10;const r=Number.isInteger(Number(s))?Number(s):0;return{pageSize:c,page:r}},y=(e,s,a)=>{const c=[10,25,50];return Number.isInteger(Number(s))?a===x.cards&&Number(e)===50?!0:!!c.includes(Number(e)):!1},pe=(e,s)=>{const c=z(),[r,o]=P(),n=w(i=>i.productAffiliateSeller.displayMode)||x.cards,[u,l]=p.useState(D(r.get("pageSize"),r.get("page"),n));p.useEffect(()=>{if(n===x.cards&&Number(r.get("pageSize")||0)!==50){const i={page:Math.floor(u.page*u.pageSize/50),pageSize:50};l(i),o(g=>({...Object.fromEntries(Array.from(g.entries())),...i}),{replace:!0})}},[n]);const d=p.useRef(!0);return p.useEffect(()=>{d.current?d.current=!1:l(i=>({pageSize:i.pageSize,page:0}))},[JSON.stringify(e)]),p.useEffect(()=>{y(r.get("pageSize"),r.get("page"),n)||o(i=>({...Object.fromEntries(Array.from(i.entries())),...D(r.get("pageSize"),r.get("page"),n)}),{replace:!0})},[r,o]),p.useEffect(()=>{(async()=>{try{y(r.get("pageSize"),r.get("page"),n)&&await s(k(Object.fromEntries(r.entries())),c)}catch{throw new Error("error fetching data")}})()},[r,c,o,s]),{paginationModel:u,setPaginationModel:l}},Re=()=>{const s=w(d=>d.productToopDrop.productsToopDrop),[a,c]=p.useState(!1),{queryFilter:r,setQueryFilter:o}=Q({isFavorite:!0}),{paginationModel:n,setPaginationModel:u}=pe(r,E),l=p.useCallback(d=>{o({})},[]);return t.jsx("div",{className:"listProductAffiliate",children:t.jsx("div",{className:"listContainer",children:t.jsx("div",{className:"listTable",children:t.jsxs("div",{className:"products datatableProducts overflowPreventer",children:[t.jsx(oe,{queryFilter:r,setQueryFilter:o,setFilterOpen:c,handleClear:l}),t.jsx(ie,{filterOpen:a,setFilterOpen:c,queryFilter:r,setQueryFilter:o}),t.jsx(ue,{paginationModel:n,setPaginationModel:u,products:s,numberOfCardsToShow:50,numberOfTotalProducts:s.totalItems,queryFilter:r,setQueryFilter:o})]})})})})};export{Re as default};
