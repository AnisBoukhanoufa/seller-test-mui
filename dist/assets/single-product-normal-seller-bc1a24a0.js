import{c as as,j as s,bB as ts,b as W,bC as is,s as ls,bD as ns,f as Z,r as l,aK as P,t as i,bE as z,T as K,ao as rs,aU as O,ap as M,ab as F,u as cs}from"./index-335be6bc.js";import{h as ds}from"./moment-fbc5633a.js";import{L as os}from"./Link-6563cda1.js";import{M as ms,T as I}from"./TextField-e3426f14.js";import{M as B}from"./MenuItem-ae06aebb.js";import{a as H,b as L,c as R}from"./DialogContent-2da759e4.js";import{D as hs}from"./DialogTitle-cffb5590.js";import{u as U}from"./useDispatch-5616ae48.js";import{S as xs}from"./sub-products-autocomplete-87ffbeaf.js";import{T as us,D as js,C as vs,a as ps,u as Ns}from"./use-images-upload-a62aca7d.js";import{u as ss,a as gs}from"./product-normal-seller-calls-a58909a0.js";import{c as ys}from"./categories-55af903f.js";import{E as Ss,C as ks,A as Cs}from"./Edit-72906540.js";import{C as q}from"./snackbar-ff9e0661.js";import{L as fs}from"./Link-f99010b1.js";import"./useSlot-06d6b379.js";import"./FormControl-0c7a5a9b.js";import"./isMuiElement-28855bcf.js";import"./List-429b0059.js";import"./Grow-32d2c9c3.js";import"./Portal-29f66c29.js";import"./Paper-7bffdec0.js";import"./useControlled-35363894.js";import"./listItemTextClasses-c15af42f.js";import"./Autocomplete-7da48e1d.js";import"./Close-a8700400.js";import"./Popper-6a651f11.js";import"./Grid-dac6798f.js";import"./Snackbar-abf2ba22.js";import"./ClickAwayListener-9b9a333f.js";import"./Alert-67637005.js";const Ds=as(s.jsx("path",{d:"m7 10 5 5 5-5z"}),"ArrowDropDown"),Es=async(t,r,e)=>{e(ts());try{const c=await W.put(`/stock-seller/status/${t}`,r);e(is(c.data._doc)),ls(c.data.responseMessage,e)}catch(c){e(ns()),Z(c,e)}};const bs=({choosenSubProduct:t,initStatus:r,stockId:e,setStocks:c})=>{const d=U(),[a,N]=l.useState(null),[x,n]=l.useState(r),[k,C]=l.useState(!1),[y,m]=l.useState(null),S=!!a,E=P(v=>v.stock.error);l.useEffect(()=>{n(r)},[r]);const j=v=>{N(v.currentTarget)},u=v=>{N(null),v&&v!==x&&(m(v),C(!0))},T=async()=>{C(!1);try{await Es(e,{status:y},d),E||(async()=>{const V=await W.get(`/stock-seller/pagination?productId=${t._id}`);c(V.data.list)})()}catch{console.log(E)}},w=()=>{C(!1),m(null)};return s.jsxs("div",{children:[s.jsxs("div",{onClick:j,className:`status-button cellWithStatus ${i(x,{lng:"en"})}`,children:[i(x)," ",s.jsx(Ds,{})]}),s.jsxs(ms,{anchorEl:a,open:S,onClose:()=>u(x),MenuListProps:{"aria-labelledby":"basic-button"},children:[s.jsx(B,{onClick:()=>u(z.available),children:i(z.available)},"search"),s.jsx(B,{onClick:()=>u(z.onHold),children:i(z.onHold)},"rejected"),s.jsx(B,{onClick:()=>u(z.outOfStock),children:i(z.outOfStock)},"rejected")]}),s.jsxs(H,{open:k,onClose:w,children:[s.jsx(hs,{children:"Confirm Status Change"}),s.jsx(L,{children:`Are you sure you want to change the status to "${i(y)}"?`}),s.jsxs(R,{children:[s.jsx(K,{onClick:w,color:"primary",children:"Cancel"}),s.jsx(K,{onClick:T,color:"primary",children:"Confirm"})]})]})]})},ws=({choosenSubProduct:t,stocks:r,setStocks:e})=>{const{t:c}=rs();return r.map((a,N)=>s.jsxs("div",{className:"stock-card",children:[s.jsx("div",{className:"stock-title",children:a.id}),s.jsxs("div",{className:"details",children:[s.jsxs("div",{className:"info",children:[s.jsx("div",{className:"stock-value",children:s.jsxs("span",{className:"itemKey status",children:[c("status")," :",s.jsx(bs,{choosenSubProduct:t,setStocks:e,initStatus:a.currentStatus,stockId:a._id})]})}),s.jsxs("div",{className:"stock-value",children:[s.jsxs("span",{className:"itemKey",children:[c("Volume")," :"]}),s.jsxs("span",{className:"itemValue",children:[a.volume," CBM"]})]}),s.jsxs("div",{className:"stock-value",children:[s.jsxs("span",{className:"itemKey",children:[c("weight")," :"]}),s.jsxs("span",{className:"itemValue",children:[a.weight," Kg"]})]}),s.jsxs("div",{className:"stock-value",children:[s.jsxs("span",{className:"itemKey",children:[c("warehouse")," :"]}),s.jsx("span",{className:"itemValue",children:c(a.warehouseId.country)})]})]}),s.jsxs("div",{className:"quantity",children:[s.jsxs("div",{className:"stock-value",children:[s.jsxs("span",{className:"itemKey",children:[c("Quantity")," :"]}),s.jsx("span",{className:"itemValue",children:a.quantity+a.quantityInReturn+a.damage})]}),s.jsxs("div",{className:"stock-value-quantity availble",children:[s.jsx("div",{className:"circle availble"}),s.jsxs("span",{className:"item-key-list",children:[c("Availble")," :"]}),s.jsx("span",{className:"itemValue",children:a.quantity})]}),s.jsxs("div",{className:"stock-value-quantity in-return",children:[s.jsx("div",{className:"circle in-return"}),s.jsxs("span",{className:"item-key-list ",children:[c("In return")," :"]}),s.jsx("span",{className:"itemValue",children:a.quantityInReturn})]}),s.jsxs("div",{className:"stock-value-quantity dammage",children:[s.jsx("div",{className:"circle dammage "}),s.jsxs("span",{className:"item-key-list",children:[c("Dammage")," :"]}),s.jsx("span",{className:"itemValue",children:a.damage})]})]})]})]}))};const Vs=({open:t,productInfo:r,handleClose:e,setProductInfo:c})=>{const d=U(),[a,N]=l.useState({}),{isFetching:x,error:n,succeed:k}=P(u=>u.productNormalSeller);l.useEffect(()=>{N({description:r==null?void 0:r.description,name:r==null?void 0:r.name})},[r]);const C=async u=>{const T=u.target.id,w=u.target.value;N({...a,[T]:w})},[y,m]=l.useState(!1),S=async()=>{try{await ss(r._id,a,d),m(!0),(async()=>{const T=await W.get(`/product-seller/single/${r._id}`);c(T.data._doc)})()}catch(u){console.log(u)}};l.useEffect(()=>{y&&x===!1&&n===!1&&k===!0&&e()},[y,x,n,k]);const[E,j]=l.useState(!1);return l.useEffect(()=>{j(x===!0&&n===!1)},[x,n]),s.jsx("div",{className:"productNormalSellerEdit",children:s.jsxs(H,{open:t,onClose:e,maxWidth:"md",children:[s.jsx(L,{children:s.jsx("div",{className:"edit-order-affiliate",children:s.jsx("div",{className:"products",children:s.jsxs("div",{className:"product-details",children:[s.jsx("h3",{children:i("Edit Product information")}),s.jsx("div",{className:"formInput",children:s.jsx(I,{fullWidth:!0,id:"name",label:i("name"),variant:"outlined",onChange:C,defaultValue:r.name})}),s.jsxs("div",{className:"descrition-edit",children:[s.jsxs("span",{className:"description-title",children:[i("description")," :"]}),s.jsx(us,{data:a,setData:N})]})]})})})}),s.jsxs(R,{children:[s.jsx(K,{onClick:e,children:i("cancel")}),s.jsx(K,{onClick:S,disabled:E,children:i("update")})]})]})})};const Ts=({details:t,setSubProducts:r,subProducts:e,images:c,selectedSubProduct:d,setSelectedSubProduct:a,offers:N,customVariations:x,setCustomVariations:n})=>{var G,J,Q;const[k,C]=l.useState({}),y=g=>{const o={},f=h=>{if(Array.isArray(h))return h;typeof h=="object"&&h!==null&&Object.entries(h).forEach(([D,_])=>{const X=f(_);X&&(o[D]=X)})};return f(g),o};l.useEffect(()=>{C({...y(t),...x})},[t]);const[m,S]=l.useState(((J=Object.keys(((G=e[0])==null?void 0:G.variations)||[]))==null?void 0:J.map(g=>({detail:g,value:""})))||[{detail:"",value:""}]);l.useEffect(()=>{var o,f;const g=(f=Object.keys(((o=e[0])==null?void 0:o.variations)??{}))==null?void 0:f.map(h=>({detail:h,value:""}));S(g)},[(Q=e[0])==null?void 0:Q.variations]);const E=()=>{S([{detail:"",value:""},...m])},[j,u]=l.useState(!1),T=()=>{u(!0)},w=()=>{u(!1)};l.useEffect(()=>{if(d!=null&&d.idTemp){const g=m.map(o=>({detail:o.detail,value:(d==null?void 0:d.variations[o.detail])||""}));S(g)}},[d==null?void 0:d.idTemp]);const v=(g,o)=>g.some(f=>Object.keys(f.variations).length!==o.length?!1:o.every(h=>f.variations[h.detail]===h.value)),V=()=>{if(!m.every(D=>D.value!=="")){p(!0);return}if(v(e,m)){$(!0);return}const o=m.reduce((D,_)=>({...D,[_.detail]:_.value}),{}),f={idTemp:"id"+Math.random().toString(16).slice(2),variations:o,isValid:!0,...c?{images:c}:{},...N?{offers:N}:{}};r(D=>[...D,{...f,changed:!0}]);const h=m.map(D=>({detail:D.detail,value:""}));S(h)},A=()=>{if(!m.every(h=>h.value!=="")){p(!0);return}if(v(e,m)&&d.idTemp){$(!0);return}const o=m.reduce((h,D)=>({...h,[D.detail]:D.value}),{});r(h=>h.map(_=>_.idTemp===d.idTemp?{..._,variations:o,isValid:!0,changed:!0}:_)),a({idTemp:""});const f=m.map(h=>({detail:h.detail,value:""}));S(f)},[b,p]=l.useState(!1),[es,$]=l.useState(!1),Y=()=>{p(!1),$(!1)};return l.useEffect(()=>{j||r(g=>g.map(o=>m.length!==Object.keys((o==null?void 0:o.variations)||{}).length?{...o,isValid:!1}:m.every(h=>o==null?void 0:o.variations[h.detail])?o:{...o,isValid:!1}))},[j]),s.jsxs("div",{className:"details",children:[s.jsxs("div",{className:"title",children:[i("details"),":",s.jsxs("div",{className:"buttons-container",children:[(e==null?void 0:e.length)>0&&!j&&s.jsx(O,{sx:{fontWeight:"bold",fontSize:"24px"},color:"primary",type:"button",onClick:T,className:"plus-button",children:s.jsx(Ss,{sx:{fontSize:28}})}),j&&s.jsx(O,{sx:{fontWeight:"bold",fontSize:"24px"},color:"primary",type:"button",onClick:w,className:"plus-button",children:s.jsx(ks,{sx:{fontSize:28}})}),(j||(e==null?void 0:e.length)<1)&&s.jsx(O,{sx:{fontWeight:"bold",fontSize:"24px"},type:"button",color:"primary",onClick:E,className:"plus-button",children:s.jsx(Cs,{sx:{fontSize:32}})})]})]}),s.jsx("div",{className:"detail-pair",children:m.map((g,o)=>s.jsx(js,{setDropDownDetails:C,dropDownDetails:k,detailPair:g,setCurrentDetails:S,currentDetails:m,index:o,subProducts:e,editVariations:j,setCustomVariations:n}))}),(d==null?void 0:d.idTemp)===""?s.jsx(K,{className:"add-sub-product",type:"button",variant:"outlined",color:"primary",fullWidth:!0,disabled:j,sx:{"&.Mui-disabled":{color:"var(--color-gray) !important",borderColor:"var(--color-gray) !important"}},onClick:V,children:i("add")}):s.jsx(K,{className:"add-sub-product",type:"button",variant:"outlined",color:"primary",fullWidth:!0,disabled:j,sx:{"&.Mui-disabled":{color:"var(--color-gray) !important",borderColor:"var(--color-gray) !important"}},onClick:A,children:i("save")}),s.jsx(q,{open:b,message:i("all values must be set before adding a sub-product !"),severity:"warning",autoHideDuration:6e3,onClose:Y}),s.jsx(q,{open:es,message:i("this sub-product already exists !"),severity:"warning",autoHideDuration:6e3,onClose:Y})]})};const Ks=({subProducts:t,productInfo:r,setSelectedSubProduct:e})=>{const c=a=>/^#[0-9A-F]{6}$/i.test(a),d=a=>{e(a)};return s.jsx("div",{className:"sub-product-cards",children:s.jsx(M,{display:"flex",flexWrap:"wrap",gap:"30px",children:t.map((a,N)=>{var x;return s.jsx(vs,{sx:{height:`${t[t.length-1]*1.8+5}em`,backgroundColor:a.isValid?"#E5FFE5":"#FFD9D9",border:a.isValid?"2px solid var(--color-secondary)":"2px solid red"},className:"card",onClick:()=>{d(a)},children:s.jsxs(ps,{className:"sub-product-details",children:[s.jsxs(F,{className:"card-title",sx:{color:a.isValid?"var(--color-secondary)":"red"},variant:"h6",component:"div",children:[r.name," ",N+1]}),s.jsxs(F,{className:"card-sub-title",variant:"subtitle1",component:"div",children:[i("details"),":"]}),(x=Object.keys((a==null?void 0:a.variations)??{}))==null?void 0:x.map((n,k)=>s.jsx(F,{component:"div",children:s.jsxs(M,{className:"detail-pair",sx:{display:"flex",alignItems:"center"},children:[s.jsxs(M,{className:"detail-key",sx:{marginRight:"8px"},children:[n,":"]}),c(a==null?void 0:a.variations[n])?s.jsx(M,{sx:{backgroundColor:a==null?void 0:a.variations[n],width:20,height:20,borderRadius:"50%"}}):s.jsx(M,{sx:{color:a.isValid?"var(--color-secondary)":"red"},className:"detail-value",children:s.jsx("strong",{children:a==null?void 0:a.variations[n]})})]})},k))]})},a.idTemp)})})})};const As=({files:t,handleFileUpload:r,handleDelete:e})=>s.jsxs("div",{className:"products-images capitalize",children:[s.jsxs("h3",{children:[" ",i("images")]}),s.jsxs("div",{className:"uploadArea",children:[s.jsx("input",{type:"file",multiple:!0,onChange:r,accept:".jpg,.jpeg,.png"}),s.jsxs("h4",{children:["drag & drop or ",s.jsx("span",{children:"choose file"})," to upload"]}),s.jsx("h5",{children:"PNG or JPG, JPEG"})]}),t.length==0&&s.jsx("p",{className:"uploadMessage",children:"Please upload some images"}),s.jsx("ul",{children:t.map((c,d)=>s.jsxs("li",{children:[c.name,s.jsx("div",{className:"deleteButton",onClick:()=>e(d),children:"X"})]},d))})]}),_s=({productInfo:t,handleClose:r,open:e})=>{var V;const c=U(),[d,a]=l.useState(t==null?void 0:t.products);l.useEffect(()=>{var b;const A=(b=t==null?void 0:t.products)==null?void 0:b.map(p=>({...p,idTemp:"id"+Math.random().toString(16).slice(2),isValid:!0}));a(A)},[t==null?void 0:t.products]);const[N,x]=l.useState(!1),n=()=>{x(!1)},k=async()=>{if(d.some(p=>!p.isValid)){x(!0);return}const b=d.filter(p=>p.changed===!0);try{if(b.length>0){const p={subProducts:b};await gs(t._id,p,c)}if(Object.keys(y).length!==Object.keys(t==null?void 0:t.customVariations).length){const p={customVariations:y};await ss(t._id,p,c)}r()}catch(p){Z(p,c),console.log(p)}},C=()=>{var b;E({idTemp:""}),m([]);const A=(b=t==null?void 0:t.products)==null?void 0:b.map(p=>({...p,idTemp:"id"+Math.random().toString(16).slice(2),isValid:!0}));a(A),r()},[y,m]=l.useState(t==null?void 0:t.customVariations),[S,E]=l.useState({idTemp:""});l.useEffect(()=>{m(t==null?void 0:t.customVariations)},[t==null?void 0:t.customVariations]);const j=((V=t==null?void 0:t.category)==null?void 0:V.reduce((A,b)=>A[b],ys))||[],{files:u,setFiles:T,handleFileUpload:w,handleDelete:v}=Ns();return s.jsxs(H,{open:e,onClose:r,maxWidth:"md",children:[s.jsxs(L,{className:"edit-sub-products",children:[s.jsxs("div",{className:"edit-section",children:[s.jsx("div",{className:"variations",children:s.jsx(Ts,{details:j,images:[],subProducts:d,setSubProducts:a,selectedSubProduct:S,setSelectedSubProduct:E,customVariations:y,setCustomVariations:m,offers:void 0})}),s.jsx("div",{className:"images",style:{minWidth:"25em"},children:s.jsx(As,{handleDelete:v,files:u,handleFileUpload:w})})]}),s.jsx("div",{className:"sub-products",children:d&&s.jsx(Ks,{setSelectedSubProduct:E,subProducts:d,productInfo:t})})]}),s.jsxs(R,{children:[s.jsx(K,{onClick:C,children:i("cancel")}),s.jsx(K,{onClick:k,children:i("update")})]}),s.jsx(q,{open:N,message:i("all sub-products must have the same variations"),severity:"warning",autoHideDuration:6e3,onClose:n})]})},me=()=>{var w;const r=cs().pathname.split("/")[2],[e,c]=l.useState({});l.useEffect(()=>{(async()=>{const V=await W.get(`/product-seller/single/${r}`);c(V.data._doc)})()},[]);const[d,a]=l.useState(!1),[N,x]=l.useState([]),[n,k]=l.useState({_id:""}),[C,y]=l.useState([]);l.useEffect(()=>{e._id&&(x(e.products),k(e.products[0]))},[e==null?void 0:e._id]),l.useEffect(()=>{n!=null&&n._id&&(async()=>{const V=await W.get(`/stock-seller/pagination?productId=${n==null?void 0:n._id}`);y(V.data.list)})()},[n]);const m=()=>{a(!0)},S=()=>{a(!1)},[E,j]=l.useState(!1),u=()=>{j(!1)},T=()=>{j(!0)};return s.jsx("div",{className:"singleProductNormalSeller",children:s.jsx("div",{className:"singleContainer overflowPreventerFlexbox",children:s.jsx("div",{className:"overflowPreventerContainer",children:s.jsx("div",{className:"overflowPreventer",children:s.jsxs("div",{className:"top",children:[s.jsxs("div",{className:"left",children:[s.jsxs("div",{className:"headerInfoContainer",children:[s.jsxs("div",{className:"headerInfo",children:[s.jsxs("div",{className:"detailItem",children:[s.jsxs("span",{className:"itemKey capitalize",children:[i("id")," :"]}),s.jsx("span",{className:"valueKey valueKeyId",children:e==null?void 0:e.id})]}),s.jsxs("div",{className:"detailItem",children:[s.jsxs("span",{className:"itemKey capitalize",children:[i("created at")," :"]}),s.jsx("span",{className:"valueKey",children:ds(e==null?void 0:e.createdAt).format("DD/MM/YYYY hh:mm A")})]})]}),s.jsx("div",{className:"editButtonContainer"}),s.jsx("div",{className:"edit-button",onClick:m,children:i("edit")})]}),s.jsx("div",{className:"item",children:s.jsxs("div",{className:"details",children:[s.jsx(Vs,{open:d,productInfo:e,handleClose:S,setProductInfo:c}),s.jsxs("div",{className:"cardTitle",children:[s.jsx("span",{className:"valueKey",children:i("product info")}),s.jsx("div",{className:"separator"})]}),s.jsxs("div",{className:"section product-info",children:[s.jsxs("div",{className:"detailItem",children:[s.jsxs("span",{className:"itemKey capitalize",children:[i("name")," :"]}),s.jsx("span",{className:"valueKey",children:e==null?void 0:e.name})]}),s.jsxs("div",{className:"detailItem",children:[s.jsxs("span",{className:"itemKey capitalize",children:[i("tags")," :"]}),s.jsx("span",{className:"valueKey tags-bullets-container",children:(w=e==null?void 0:e.category)==null?void 0:w.map((v,V)=>s.jsx("span",{className:"tags-bullets",children:i(v)}))})]}),s.jsxs("div",{className:"detailItem",children:[s.jsxs("span",{className:"itemKey capitalize",children:[i("status")," :"]}),s.jsx("div",{className:`cellWithStatus ${i(`${e==null?void 0:e.currentStatus}`,{lng:"en"})}`,children:i(`${e==null?void 0:e.currentStatus}`)})]}),s.jsxs("div",{className:"url",children:[s.jsx("div",{className:"detailItem",children:s.jsxs("span",{className:"itemKey capitalize",children:[i("url")," :"]})}),s.jsxs("div",{className:"link-field",children:[s.jsx(I,{fullWidth:!0,id:"url",InputProps:{readOnly:!0},value:e==null?void 0:e.url}),s.jsx(K,{component:fs,rel:"noopener",target:"_blank",href:`${e==null?void 0:e.url}`,children:s.jsx(os,{})})]})]}),s.jsxs("div",{className:"detailItem description",children:[s.jsxs("span",{className:"itemKey capitalize",children:[i("product description")," :"]}),s.jsx("div",{style:{color:"black"},className:"description-container",dangerouslySetInnerHTML:{__html:e==null?void 0:e.description}})]})]})]})})]}),s.jsx("div",{className:"right",children:s.jsxs("div",{className:"detailItem stocks",children:[s.jsxs("div",{className:"details-sub-product",children:[s.jsx(_s,{open:E,productInfo:e,handleClose:u}),s.jsxs("div",{className:"sub-product",children:[s.jsx(xs,{choosenProduct:e,subProducts:N,choosenSubProduct:n,setChoosenSubProduct:k,width:"100%"}),s.jsx("div",{className:"edit-button secondary-button",onClick:T,children:i("edit")})]}),s.jsxs("div",{className:"detailItem",children:[s.jsxs("span",{className:"itemKey",children:[i("id")," :"]}),s.jsx("span",{className:"valueKey valueKeyId",children:n==null?void 0:n.id})]}),s.jsxs("div",{className:"status",children:[s.jsxs("div",{className:"key",children:[i("status")," : "]}),s.jsx("div",{className:`cellWithStatus ${i(n==null?void 0:n.currentStatus,{lng:"en"})}`,children:i(n==null?void 0:n.currentStatus)})]})]}),s.jsxs("span",{className:"item-key-title capitalize",children:[i("stocks")," :"]}),s.jsx("div",{className:"stocks-container",children:C.length>0&&s.jsx(ws,{choosenSubProduct:n,setStocks:y,stocks:C})})]})})]})})})})})};export{me as default};
