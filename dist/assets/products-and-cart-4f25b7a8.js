import{u as E,r as c,j as s,t as u,T as _}from"./index-335be6bc.js";import{s as k}from"./functions-6046b92c.js";import{u as A}from"./useDispatch-5616ae48.js";import{P as T}from"./products-autocomplete-4bf85a69.js";import{S as R}from"./sub-products-autocomplete-87ffbeaf.js";import{C as q}from"./snackbar-ff9e0661.js";import{u as U,a as F}from"./client-form-de2a353f.js";import{T as O}from"./TextField-e3426f14.js";const M=(t,d)=>{const r=E(),a=new URLSearchParams(r.search).get("country"),b=A(),[l,j]=c.useState([]),[y,m]=c.useState(!1);return{cart:l,setCart:j,handleSubmitOrder:async e=>{var o,i;const P=a==="local"?(o=e==null?void 0:e.client)==null?void 0:o.country:a,C={...e,client:{...e.client,phone:k((i=e==null?void 0:e.client)==null?void 0:i.phone)},warehouseCountry:Number(P),products:l};try{m(!0),await t(C,b),d(),j([])}catch(p){console.log(p)}m(!1)},disableSubmitButton:y}},D="/assets/trash-932514f9.svg";const B=({subProduct:t,handleRemoveProduct:d})=>s.jsx(s.Fragment,{children:s.jsxs("div",{className:"cartProduct",children:[s.jsxs("span",{className:"title-cart",children:[t.name," ",t.variations&&s.jsxs(s.Fragment,{children:[Object.entries(t.variations).filter(([r])=>r!=="color").map(([r,n],a)=>s.jsxs("span",{children:[n," "]},a)),t.variations.color&&/^#([0-9A-F]{3}){1,2}$/i.test(t.variations.color)&&s.jsx("span",{style:{display:"inline-block",width:"20px",height:"20px",borderRadius:"50%",backgroundColor:t.variations.color,marginLeft:"5px"}})]})]}),s.jsxs("div",{className:"container-details",children:[s.jsxs("div",{className:"cartProduct-right",children:[t.isConfirmed&&s.jsxs("span",{className:"wordsWrapper",children:[u("confirmed")," "]}),t.isUpsell&&s.jsxs("span",{className:"wordsWrapper",children:[u("upsell")," "]}),s.jsxs("span",{className:"wordsWrapper",children:[u("quantity")," : ",t.quantity]})]}),s.jsx("div",{className:"cartProduct-left"}),s.jsx("div",{children:s.jsx("img",{className:"trash",src:D,onClick:()=>{d(t)}})})]})]},t._id)}),I=(t,d,r)=>{const[n,a]=c.useState(0),[b,l]=c.useState(!1),[j,y]=c.useState(!1),{products:m,choosenProduct:h,setChoosenProduct:e,setProducts:P}=U(t),{subProducts:C,choosenSubProduct:o,setChoosenSubProduct:i}=F(h),p=c.useCallback(()=>{y(!1),l(!1)},[]),v=c.useCallback(()=>{i({_id:""}),e({_id:"",name:"",products:[]}),a(1),p()},[p,e,i]);c.useEffect(()=>{v()},[d.length,v]);const x=c.useCallback(()=>o._id===""?(y(!0),!1):Number(n)<1?(l(!0),!1):!0,[o._id,n]);return{products:m,setProducts:P,subProducts:C,quantityError:b,productError:j,clearErrors:p,quantity:n,setQuantity:a,choosenProduct:h,setChoosenProduct:e,choosenSubProduct:o,setChoosenSubProduct:i,handleAddToCart:()=>{if(x()){const f={...o,name:h.name,productId:o._id,quantity:Number(n)};r(S=>{const N=[...S],g=N.find(w=>w._id===f._id&&w.isUpsell===f.isUpsell);return g?g.quantity+=f.quantity:N.unshift(f),[...N]}),v()}},handleRemoveProduct:f=>{r(S=>S.filter(g=>!(g._id===f._id&&g.isUpsell==f.isUpsell)))}}},X=({sellerType:t,productType:d,cart:r,setCart:n})=>{const{products:a,setProducts:b,subProducts:l,quantityError:j,productError:y,clearErrors:m,quantity:h,setQuantity:e,choosenProduct:P,setChoosenProduct:C,choosenSubProduct:o,setChoosenSubProduct:i,handleAddToCart:p,handleRemoveProduct:v}=I(t,r,n);return s.jsxs(s.Fragment,{children:[s.jsx("h3",{children:u("products")}),s.jsx("div",{className:"formInput",children:s.jsx(T,{products:a,setProducts:b,choosenProduct:P,setChoosenProduct:C,sellerType:t,productType:d,width:"100%"})}),s.jsx("div",{className:"formInput",children:s.jsxs("div",{className:"sub-product-container",children:[s.jsx(R,{choosenProduct:P,subProducts:l,choosenSubProduct:o,setChoosenSubProduct:i,width:"100%"}),s.jsx(O,{id:"quantity",label:u("quantity"),value:Number(h)||"",type:"number",variant:"outlined",placeholder:"0",inputProps:{min:1,step:1},onChange:x=>e(x.target.value)})]})}),s.jsx(_,{className:"secondary-button",onClick:p,disabled:Number(h)<0,type:"button",children:u("add")}),s.jsx("div",{className:"cartProductContainer",children:r.length>0&&r.map(x=>s.jsx(B,{subProduct:x,handleRemoveProduct:v},x.name+x._id))}),s.jsx(q,{open:j,message:u("quantity must be greater than 0"),severity:"warning",autoHideDuration:6e3,onClose:m}),s.jsx(q,{open:y,message:u("you need to select product first"),severity:"warning",autoHideDuration:6e3,onClose:m})]})};export{X as P,M as u};
