import{j as s,aT as M,t as l,T as S,ap as Y,ak as T,aj as D,r,E as Q,c as G,bU as J}from"./index-335be6bc.js";import{h as K}from"./moment-fbc5633a.js";import{S as X}from"./status-cell-abbf33fa.js";import{L as Z}from"./Link-6563cda1.js";import{T as O}from"./TextField-e3426f14.js";import{L as f}from"./Link-f99010b1.js";import{C as I,E as ss,A as es}from"./Edit-72906540.js";import{b as ts,a as as,S as ls}from"./Stepper-66417976.js";import{P as is}from"./products-autocomplete-4bf85a69.js";import{S as cs}from"./sub-products-autocomplete-87ffbeaf.js";import{u as ns,a as ds,C as us}from"./client-form-de2a353f.js";import{a as U,b as E,c as F}from"./DialogContent-2da759e4.js";import{D as V}from"./DialogTitle-cffb5590.js";import{C as R}from"./Checkbox-863386b3.js";import{u as w}from"./useDispatch-5616ae48.js";import{s as hs}from"./functions-6046b92c.js";import{u as B,C as ms}from"./index.esm-6c063bf2.js";const P=({label:e,value:t})=>s.jsxs("div",{className:"detailItem",children:[s.jsxs("span",{className:"itemKey",children:[e," :"]}),s.jsx("span",{className:"valueKey",children:t})]}),H=({sellerId:e,username:t})=>e?s.jsx(M,{to:`/sellers/${e}`,children:t}):null,xs=({creatorId:e,username:t})=>e?s.jsx(M,{to:`/employees/${e}`,children:t}):null,Ts=({orderInfo:e,handleOpenEditOrderInfoDialog:t,handleOpenEditClientInfoDialog:a})=>{var h,i,c,m,x,d,u,n,C,N,v,p,y,o,b,g,j,k;return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"section ",children:s.jsx("div",{className:"headerInfoContainer",children:s.jsxs("div",{className:"headerInfo",children:[s.jsxs("div",{className:"detailItem",children:[s.jsx("span",{className:"itemKey",children:l("id")}),s.jsx("span",{className:"valueKey valueKeyId",children:e==null?void 0:e.id})]}),s.jsxs("div",{className:"detailItem",children:[s.jsx("span",{className:"itemKey",children:l("created at")}),s.jsx("span",{className:"valueKey",children:K(e==null?void 0:e.createdAt).format("DD/MM/YYYY hh:mm A")})]})]})})}),s.jsxs("div",{className:"section",children:[s.jsxs("div",{className:"sectionTitle",children:[s.jsx("h1",{className:"title",children:l("client info")}),s.jsx("div",{className:"separator"})]}),s.jsxs("div",{className:"details",children:[s.jsxs("div",{className:"order-infos",children:[s.jsx(P,{label:l("name"),value:(h=e==null?void 0:e.client)==null?void 0:h.name}),s.jsx(P,{label:l("phone"),value:`+${(i=e==null?void 0:e.client)==null?void 0:i.phone.code}-${(c=e==null?void 0:e.client)==null?void 0:c.phone.number}`}),s.jsx(P,{label:l("country"),value:l((m=e==null?void 0:e.client)==null?void 0:m.country)||"/"}),s.jsx(P,{label:l("city"),value:((x=e==null?void 0:e.client)==null?void 0:x.city)||"/"}),Object.entries(((d=e==null?void 0:e.client)==null?void 0:d.additionalInformation)||{}).map(([q,$])=>s.jsx(P,{label:l(q),value:$})),s.jsx(P,{label:l("district"),value:((u=e==null?void 0:e.client)==null?void 0:u.district)||"/"}),s.jsx(P,{label:l("address"),value:((n=e==null?void 0:e.client)==null?void 0:n.address)||"/"}),s.jsxs("div",{className:"url",children:[s.jsx("div",{className:"detailItem",children:s.jsxs("span",{className:"itemKey capitalize",children:[l("location")," :"]})}),s.jsxs("div",{className:"link-field",children:[s.jsx(O,{fullWidth:!0,id:"location",InputProps:{readOnly:!0},value:(C=e==null?void 0:e.client)==null?void 0:C.location}),s.jsx(S,{component:f,rel:"noopener",target:"_blank",href:`${(N=e==null?void 0:e.client)==null?void 0:N.location}`,children:s.jsx(Z,{})})]})]})]}),s.jsx("div",{className:"edit-section",children:s.jsx("div",{className:"secondary-button",onClick:a,children:l("edit")})})]})]}),s.jsxs("div",{className:"section",children:[s.jsxs("div",{className:"sectionTitle",children:[s.jsx("h1",{className:"title",children:l("order info")}),s.jsx("div",{className:"separator"})]}),s.jsxs("div",{className:"details",children:[s.jsxs("div",{className:"order-infos",children:[s.jsx(P,{label:l("seller"),value:s.jsx(H,{sellerId:(v=e==null?void 0:e.sellerId)==null?void 0:v._id,username:(p=e==null?void 0:e.sellerId)==null?void 0:p.username})}),s.jsx(P,{label:l("price"),value:s.jsxs(s.Fragment,{children:[(e==null?void 0:e.totalPrice)||"/"," ",s.jsx("span",{className:"uppercase",children:l(e==null?void 0:e.currency)})]})}),s.jsx(P,{label:l("status"),value:s.jsx(X,{status:e==null?void 0:e.currentStatus})}),s.jsx(P,{label:l("note"),value:(e==null?void 0:e.note)||"/"}),s.jsx(P,{label:l("is confirmed"),value:e!=null&&e.isConfirmed?l("yes"):l("no")}),s.jsx(P,{label:l("order creator"),value:((y=e==null?void 0:e.sellerId)==null?void 0:y._id)===((o=e==null?void 0:e.creatorId)==null?void 0:o._id)?s.jsx(H,{sellerId:(b=e==null?void 0:e.sellerId)==null?void 0:b._id,username:(g=e==null?void 0:e.sellerId)==null?void 0:g.username}):s.jsx(xs,{creatorId:(j=e==null?void 0:e.creatorId)==null?void 0:j._id,username:(k=e==null?void 0:e.creatorId)==null?void 0:k.username})})]}),s.jsx("div",{className:"edit-section",children:s.jsx("div",{className:"secondary-button",onClick:t,children:l("edit")})})]})]})]})},ps=e=>{const{className:t}=e,{singleStatus:a,statusTitle:h}=e,i=h.startsWith("call");return s.jsx("div",{className:t,style:{backgroundColor:a.isVisible?i?"var(--color-gray)":`var(--color-${a.status})`:"#D3D3D3",borderRadius:"50%",width:i?15:25,height:i?15:25,display:"flex",alignItems:"center",justifyContent:"center",marginRight:10},children:!i&&s.jsx("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:"white"},children:s.jsx(I,{fontSize:"small"})})})},js=({singleStatus:e,statusTitle:t})=>s.jsx(s.Fragment,{children:s.jsx(ts,{StepIconComponent:a=>s.jsx(ps,{...a,statusTitle:t,singleStatus:e}),children:s.jsx(Y,{className:"stepper",sx:{display:"flex",gap:"10px",justifyContent:"space-between",alignItems:"center"},children:s.jsxs(Y,{style:{display:"flex",flexDirection:"column"},children:[s.jsx(Y,{sx:{display:"flex",alignItems:"center",gap:1},children:s.jsx(Y,{sx:{display:"inline-block",color:"white",backgroundColor:t.startsWith("call")?"var(--color-gray)":`var(--color-${e.status})`,p:1/4,pl:1,pr:1,borderRadius:1.5},children:t})}),e.reason!==T.none&&e.reason!==T.other&&s.jsxs("span",{children:[l(`${e.reason}`)," ",e.reason===T.delayed&&s.jsxs("span",{children:[l("to")," :"," ",K(e.delayed).format("DD-MM-YYYY hh:mm A")]})]}),s.jsxs("span",{children:[K(e.date).format("DD-MM-YYYY hh:mm A")," "]})]})})})}),rs=({orderInfo:e})=>{var h,i;var t=0,a=0;return s.jsx(s.Fragment,{children:s.jsx(as,{orientation:"vertical",activeStep:(h=e==null?void 0:e.status)==null?void 0:h.length,children:(i=e==null?void 0:e.status)==null?void 0:i.map((c,m,x)=>{let d=l(c.status);return c.status===D.inConfirmation?(t!==0&&x[m-1].status===D.inConfirmation&&(d=`${l("call")}${("0"+t).slice(-2)}`),c.isVisible&&t++):t=0,c.status===D.shipping?(a!==0&&x[m-1].status===D.shipping&&(d=`${l("call")}${("0"+a).slice(-2)}`),c.isVisible&&a++):a=0,c&&s.jsx(ls,{sx:{ml:d.startsWith("call")?7:0},children:s.jsx(js,{singleStatus:c,statusTitle:d})},c.status)})})})},Ks=({orderInfo:e})=>s.jsxs("div",{className:"section",children:[s.jsxs("div",{className:"sectionTitle",children:[s.jsx("div",{className:"title",children:l("tracking")}),s.jsx("div",{className:"separator"})]}),s.jsx("div",{className:"scroll-y",children:s.jsx(rs,{orderInfo:e})})]});const vs=e=>{const[t,a]=r.useState([]),[h,i]=r.useState(!1),[c,m]=r.useState(!1),[x,d]=r.useState(""),[u,n]=r.useState(!1),[C,N]=r.useState("");r.useEffect(()=>{e!=null&&e.products&&a(e.products)},[e==null?void 0:e.products]);const v=r.useCallback(()=>{i(!0)},[]),p=r.useCallback(()=>{i(!1)},[]),y=r.useCallback(j=>{d(j),m(!0)},[]),o=r.useCallback(()=>{m(!1),d("")},[]),b=r.useCallback(j=>{N(j),n(!0)},[]),g=r.useCallback(()=>{n(!1)},[]);return{openAddProduct:h,setOpenAddProduct:i,handleOpenAddProductDialog:v,handleCloseAddProductDialog:p,productsToShow:t,openWarningDeleteProduct:c,handleClickDeleteProduct:y,handleCloseDeleteProductPopup:o,productToDelete:x,openEditProduct:u,setOpenEditProduct:n,productToEdit:C,handleEditProduct:b,handleCloseEditProductDialog:g}};const ys=({orderInfo:e,open:t,fetchSingleData:a,updateOrderProducts:h,handleCloseAddProductDialog:i,productsToShow:c,productType:m})=>{var $;const x=w(),[d,u]=r.useState(0),[n,C]=r.useState(!1),N=()=>{o({_id:"",name:"",products:[]}),k({_id:""}),u(""),C(!1),i()},v=W=>{C(W.target.checked)},{products:p,choosenProduct:y,setChoosenProduct:o,setProducts:b}=ns(m),{subProducts:g,choosenSubProduct:j,setChoosenSubProduct:k}=ds(y),q=async W=>{const z={productId:j._id,quantity:d,isUpsell:n},_=c.map(A=>({productId:A.productId._id,quantity:A.quantity,isUpsell:A.isUpsell})),L=_.findIndex(A=>A.productId===z.productId);L!==-1&&_[L].isUpsell===z.isUpsell?_[L].quantity=_[L].quantity+z.quantity:_.push(z);try{await h(e._id,{products:_},x),await a()}catch(A){console.log(A)}};return s.jsx("div",{children:s.jsxs(U,{open:t,onClose:N,children:[s.jsx(V,{className:"dialog-title capitalize",children:s.jsx("span",{className:"capitalize",children:l("add product")})}),s.jsx(E,{sx:{width:400},children:s.jsxs("div",{className:"cart",children:[s.jsx("div",{className:"formInput",children:s.jsx(is,{products:p,setProducts:b,choosenProduct:y,setChoosenProduct:o,sellerType:Q.seller,sellerId:($=e==null?void 0:e.sellerId)==null?void 0:$._id,productType:m})}),y._id&&s.jsx("div",{className:"formInput",children:s.jsx(cs,{choosenProduct:y,subProducts:g,choosenSubProduct:j,setChoosenSubProduct:k})}),s.jsx("div",{className:"formInput",children:s.jsx(O,{fullWidth:!0,id:"quantity",label:l("quantity"),value:d||"",type:"number",variant:"outlined",placeholder:"0",inputProps:{min:"1"},onChange:W=>u(Number(W.target.value))})}),s.jsx("div",{className:"formInput checkboxs",children:s.jsxs("div",{children:[s.jsx(R,{name:"isUpsell",checked:n,onChange:v}),s.jsx("span",{className:"capitalize",children:l("is upsell")})]})})]})}),s.jsxs(F,{children:[s.jsx(S,{onClick:N,children:s.jsx("span",{className:"capitalize",children:l("cancel")})}),s.jsx(S,{disabled:!j._id||!d,onClick:q,className:"capitalize",children:s.jsx("span",{className:"capitalize",children:l("add")})})]})]})})};const Ns=({orderInfo:e,open:t,handleCloseAddProductDialog:a,productsToShow:h,productToEdit:i,updateOrderProducts:c,fetchSingleData:m})=>{const x=w(),[d,u]=r.useState(0),[n,C]=r.useState(!1);r.useEffect(()=>{u(i==null?void 0:i.quantity),C(i==null?void 0:i.isUpsell)},[i]);const N=()=>{u(""),C(!1),a()},v=y=>{C(y.target.checked)},p=async y=>{const o={productId:i.productId._id,quantity:d,isUpsell:n},b=h.filter(j=>j._id!==i._id).map(j=>({productId:j.productId._id,quantity:j.quantity,isUpsell:j.isUpsell})),g=b.findIndex(j=>j.productId===o.productId);g!==-1&&b[g].isUpsell===o.isUpsell?b[g].quantity=b[g].quantity+o.quantity:b.push(o);try{await c(e._id,{products:b},x),await m()}catch(j){console.log(j)}};return s.jsx("div",{children:s.jsxs(U,{open:t,onClose:N,children:[s.jsx(V,{className:"dialog-title capitalize",children:s.jsx("span",{className:"capitalize",children:l("edit product")})}),s.jsx(E,{sx:{width:400},children:s.jsxs("div",{className:"cart",children:[s.jsx("div",{className:"formInput",children:s.jsx(O,{fullWidth:!0,id:"quantity",label:l("quantity"),value:d||"",type:"number",variant:"outlined",placeholder:"0",inputProps:{min:"1"},onChange:y=>u(Number(y.target.value))})}),s.jsx("div",{className:"formInput checkboxs",children:s.jsxs("div",{children:[s.jsx(R,{name:"isUpsell",checked:n,onChange:v}),s.jsx("span",{className:"capitalize",children:l("is upsell")})]})})]})}),s.jsxs(F,{children:[s.jsx(S,{onClick:N,children:s.jsx("span",{className:"capitalize",children:l("cancel")})}),s.jsx(S,{onClick:p,className:"capitalize",children:s.jsx("span",{className:"capitalize",children:l("change")})})]})]})})};const Cs=G(s.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever"),bs=({orderInfo:e,productInfo:t,handleClickDeleteProduct:a,handleEditProduct:h,orderType:i})=>{var m,x,d,u,n,C,N,v;let c="";return i==="seller"?c=`/products-normal-seller/${t.productId.productId._id}`:i==="affiliate"?c=`/products-affiliate-seller/${t.productId.productId._id}`:i==="toopDrop"&&(c=`/products-toop-drop/${t.productId.productId._id}`),s.jsx(s.Fragment,{children:s.jsxs(M,{className:"product",to:c,target:"_blank",rel:"noopener noreferrer",children:[s.jsx("div",{className:"img-container",style:{backgroundImage:(x=(m=t==null?void 0:t.productId)==null?void 0:m.images)!=null&&x[0]?`url('${(u=(d=t==null?void 0:t.productId)==null?void 0:d.images)==null?void 0:u[0]}')`:"none"}}),s.jsx("div",{className:"info-container",children:s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"title",children:[(n=t==null?void 0:t.productId)==null?void 0:n.productId.name,((C=t==null?void 0:t.productId)==null?void 0:C.variations)&&s.jsx(s.Fragment,{children:Object.entries((N=t==null?void 0:t.productId)==null?void 0:N.variations).map(([p,y])=>s.jsx("span",{children:y},p+y))})]}),t.isUpsell===!0&&s.jsx("div",{className:"cellWithStatus upsell capitalize",children:l("upsell")}),e.currentStatus===D.new&&s.jsx("div",{onClick:p=>{p.stopPropagation(),p.preventDefault(),h(t)},className:"cellWithStatus edit capitalize",children:s.jsx(ss,{})}),e.currentStatus===D.new&&s.jsx("div",{onClick:p=>{p.stopPropagation(),p.preventDefault(),a(t)},className:"cellWithStatus delete capitalize",children:s.jsx(Cs,{})}),s.jsx("div",{className:"sub-info",children:s.jsxs("div",{className:"key-value-pair",children:[s.jsxs("div",{className:"key",children:[" ",l("quantity"),":"]}),s.jsx("div",{className:"value",children:((v=t==null?void 0:t.offer)==null?void 0:v.quantity)||(t==null?void 0:t.quantity)})]})})]})})]})})},os=({open:e,onClose:t,orderInfo:a,productsToShow:h,productToDelete:i,updateOrderProducts:c,fetchSingleData:m})=>{const x=w(),d=r.useCallback(async()=>{const u={products:h.filter(n=>n._id!==i._id).map(n=>({productId:n.productId._id,quantity:n.quantity||n.offer.quantity,isUpsell:n.isUpsell}))};try{await c(a._id,u,x),await m(),t()}catch(n){console.error("Failed to delete product:",n)}},[h,i._id,c,a._id,x,m,t]);return s.jsxs(U,{open:e,onClose:t,children:[s.jsx(V,{children:l("delete")}),s.jsx(E,{children:l("Are you sure you want to delete this product?")}),s.jsxs(F,{children:[s.jsxs(S,{onClick:t,children:[" ",l("close")]}),s.jsx(S,{onClick:d,color:"primary",children:l("delete")})]})]})},gs=({orderInfo:e,updateOrderProducts:t,fetchSingleData:a,productType:h,orderType:i})=>{const{openAddProduct:c,setOpenAddProduct:m,handleOpenAddProductDialog:x,handleCloseAddProductDialog:d,productsToShow:u,productToDelete:n,openWarningDeleteProduct:C,handleClickDeleteProduct:N,handleCloseDeleteProductPopup:v,openEditProduct:p,setOpenEditProduct:y,productToEdit:o,handleEditProduct:b,handleCloseEditProductDialog:g}=vs(e),j=u;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"container-products",children:[j.map(k=>s.jsx(bs,{orderInfo:e,handleEditProduct:b,handleClickDeleteProduct:N,productInfo:k,orderType:i},k._id)),e.currentStatus===D.new&&s.jsx("div",{className:"add-product",children:s.jsx(es,{onClick:x,className:"add-icon",style:{fontSize:60,cursor:"pointer"}})})]}),e.currentStatus===D.new&&s.jsxs(s.Fragment,{children:[s.jsx(os,{open:C,onClose:v,orderInfo:e,productsToShow:u,productToDelete:n,updateOrderProducts:t,fetchSingleData:a}),s.jsx(ys,{setOpen:m,open:c,orderInfo:e,fetchSingleData:a,updateOrderProducts:t,handleCloseAddProductDialog:d,productsToShow:u,productType:h}),s.jsx(Ns,{setOpen:y,open:p,productToEdit:o,orderInfo:e,handleCloseAddProductDialog:g,productsToShow:u,updateOrderProducts:t,fetchSingleData:a})]})]})},Ms=({orderInfo:e,fetchSingleData:t,updateOrderProducts:a,productType:h,orderType:i})=>s.jsxs("div",{className:"section productContainer",children:[s.jsxs("div",{className:"sectionTitle",children:[s.jsx("div",{className:"title",children:l("products")}),s.jsx("div",{className:"separator"})]}),s.jsx(gs,{orderInfo:e,updateOrderProducts:a,fetchSingleData:t,productType:h,orderType:i})]}),Vs=(e,t)=>{const a=w(),[h,i]=r.useState({}),[c,m]=r.useState(!1),x=r.useCallback(async()=>{var d;try{const u=await t(e,a);i(u._doc)}catch(u){J.isAxiosError(u)&&((d=u.response)==null?void 0:d.status)===404&&m(!0)}},[]);return r.useEffect(()=>{x()},[]),{singleData:h,setSingleData:i,notFound:c,fetchSingleData:x}};const Rs=({open:e,setOpen:t,orderInfo:a,updateOrder:h,fetchSingleData:i})=>{const c=w(),{register:m,formState:{errors:x},handleSubmit:d,control:u,reset:n}=B();r.useEffect(()=>{var v,p,y,o,b,g,j,k,q;a&&n({client:{name:(v=a.client)==null?void 0:v.name,phone:((y=(p=a==null?void 0:a.client)==null?void 0:p.phone)==null?void 0:y.code)+((b=(o=a==null?void 0:a.client)==null?void 0:o.phone)==null?void 0:b.number),address:(g=a.client)==null?void 0:g.address,district:(j=a.client)==null?void 0:j.district,city:(k=a.client)==null?void 0:k.city,country:(q=a.client)==null?void 0:q.country}})},[a,n]);const C=async v=>{const p={client:{...v.client,phone:hs(v.client.phone)}};try{await h(a._id,p,c),i()}catch(y){console.log(y)}t(!1)},N=()=>{t(!1)};return s.jsx(U,{open:e,onClose:N,children:s.jsxs("form",{onSubmit:d(C),children:[s.jsx(E,{className:"edit-order-client",sx:{width:400},children:s.jsx(us,{formRegister:m,formErrors:x,formControl:u})}),s.jsxs(F,{children:[s.jsx(S,{type:"button",onClick:N,children:l("cancel")}),s.jsx(S,{type:"submit",children:l("save")})]})]})})};const Hs=({open:e,setOpen:t,orderInfo:a,updateOrder:h,fetchSingleData:i})=>{const c=w(),{register:m,formState:{errors:x},handleSubmit:d,control:u,reset:n}=B({defaultValues:{note:a==null?void 0:a.note,isConfirmed:a==null?void 0:a.isConfirmed,totalPrice:a==null?void 0:a.totalPrice}});r.useEffect(()=>{a&&n({note:a==null?void 0:a.note,isConfirmed:a==null?void 0:a.isConfirmed,totalPrice:a==null?void 0:a.totalPrice})},[a,n]);const C=async v=>{try{await h(a._id,v,c),i()}catch(p){console.log(p)}t(!1)},N=()=>{t(!1)};return s.jsx(U,{open:e,onClose:N,children:s.jsxs("form",{onSubmit:d(C),children:[s.jsxs(E,{className:"edit-order-client",sx:{width:400},children:[s.jsx("div",{className:"formInput",children:s.jsx(O,{fullWidth:!0,id:"note",label:l("note"),variant:"outlined",...m("note")})}),s.jsxs("div",{className:"formInput",children:[s.jsx(O,{fullWidth:!0,...m("totalPrice",{required:"please enter a valid value",min:1}),id:"totalPrice",label:l("total price"),type:"number",variant:"outlined"}),x.totalPrice&&s.jsx("p",{className:"errorValidation",children:"Please enter a valid value"})]}),s.jsxs("div",{className:"formInput checkboxs",children:[s.jsx(ms,{name:"isConfirmed",control:u,defaultValue:a==null?void 0:a.isConfirmed,render:({field:v})=>s.jsx(R,{...v,checked:v.value})}),s.jsx("span",{children:l("is confirmed")})]})]}),s.jsxs(F,{children:[s.jsx(S,{type:"button",onClick:N,children:l("cancel")}),s.jsx(S,{type:"submit",children:l("save")})]})]})})};export{Rs as C,Hs as I,Ts as O,Ms as P,Ks as T,Vs as u};
